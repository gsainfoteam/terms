{{ define "main" }}
  <div class="max-w-4xl mx-auto px-4 py-8">
    <!-- 동적으로 생성되는 서비스별 약관 섹션 -->
    <h2 class="text-xl font-semibold text-gray-900 mb-6">서비스별 약관</h2>

    {{/* 서비스별로 그룹화하여 표시 */}}
    {{ $services := dict }}
    {{ range $_, $section := .Site.Sections }}
      {{ range .Pages }}
        {{ $serviceName := strings.TrimPrefix "/" $section.Path }}
        {{ $serviceData := index $services $serviceName | default dict }}
        {{ $type := index (strings.Split .Path "/" | last 2) 0 }}
        {{ $cachedPage := index $serviceData $type }}
        {{ if $cachedPage }}
          {{ if ge .Date $cachedPage.Date }}
            {{ $serviceData = merge $serviceData (dict $type .) }}
          {{ end }}
        {{ else }}
          {{ $serviceData = merge $serviceData (dict $type .) }}
        {{ end }}
        {{ $services = merge $services (dict $serviceName $serviceData) }}
      {{ end }}
    {{ end }}

    {{/* 서비스별 섹션 렌더링 */}}
    {{ $serviceConfig := dict
      "pot-g" (dict "name" "POT-G" "color" "blue" "icon" "P")
      "ziggle" (dict "name" "Ziggle" "color" "purple" "icon" "Z")
      "idp" (dict "name" "GIST 메일로 로그인" "color" "green" "icon" "I")
    }}

    {{ $typeMap := dict
      "privacy" "개인정보처리방침"
      "tos" "이용약관"
    }}

    {{ range $serviceName, $serviceData := $services }}
      {{ $config := index $serviceConfig $serviceName }}
      {{ if $config }}
        <div class="mb-8">
          <h3 class="text-lg font-medium text-gray-900 mb-4 flex items-center">
            <span
              class="w-8 h-8 bg-{{ $config.color }}-100 rounded-full flex items-center justify-center mr-3"
            >
              <span class="text-sm font-bold text-{{ $config.color }}-600"
                >{{ $config.icon }}</span
              >
            </span>
            {{ $config.name }}
          </h3>
          <div class="grid md:grid-cols-2 gap-4">
            {{ range $type, $page := $serviceData }}
              <a
                href="{{ .Permalink }}"
                class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors"
              >
                <div>
                  <h4 class="font-medium text-gray-900">{{ .Title }}</h4>
                  <p class="text-sm text-gray-600">
                    {{ if .Date }}
                      {{ .Date.Format "2006년 1월 2일" }} 시행
                    {{ else }}
                      {{ .Lastmod.Format "2006년 1월 2일" }} 업데이트
                    {{ end }}
                  </p>
                </div>
                <svg
                  class="w-5 h-5 text-gray-400"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  ></path>
                </svg>
              </a>
            {{ end }}
          </div>
        </div>
      {{ end }}
    {{ end }}
  </div>
{{ end }}
